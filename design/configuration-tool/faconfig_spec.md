# .faconfig File Format Specification

Version: 2.0

## Overview
The `.faconfig` file is a JSON-based configuration file that defines a fire alarm system's device configuration and cause-and-effect logic. It is generated by the Configuration Tool and imported by the Alarm Simulator.

## Version History

| Version | Changes |
|---------|---------|
| 1.0 | Initial format with device-based zone assignments |
| 2.0 | Added multi-function device support, UUID-based addressing, function-level zone assignments |

## File Extension
`.faconfig` (internally JSON)

## Schema (v2.0)

```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "type": "object",
  "required": ["version", "projectName", "createdAt", "devices", "zones", "causeEffect"],
  "properties": {
    "version": { "type": "string", "const": "2.0" },
    "projectName": { "type": "string", "maxLength": 100 },
    "createdAt": { "type": "string", "format": "date-time" },
    "devices": { "type": "array", "items": { "$ref": "#/$defs/device" } },
    "zones": { "$ref": "#/$defs/zones" },
    "causeEffect": { "type": "array", "items": { "$ref": "#/$defs/ceRule" } }
  }
}
```

## Field Definitions

### Root Object

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `version` | string | Yes | Format version: "2.0" |
| `projectName` | string | Yes | Human-readable project name |
| `createdAt` | string | Yes | ISO 8601 timestamp of creation |
| `devices` | array | Yes | List of configured devices |
| `zones` | object | Yes | Detection and alarm zone definitions |
| `causeEffect` | array | Yes | Cause & Effect rules (UUID-based) |

### Device Object (v2.0)

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `address` | string | Yes | Device address (e.g., "A.001.001") |
| `primaryUuid` | string | Yes | UUID v7 identifier for the device |
| `type` | string | Yes | One of: "detector", "mcp", "sounder" |
| `subType` | string | No | e.g., "heat-multi", "optical", "bell" |
| `location` | string | Yes | Room/area name |
| `label` | string | No | User-friendly display label |
| `functions` | array | Yes | Array of device functions (see below) |

### Device Function Object (NEW in v2.0)

Multi-function devices (e.g., Autoguard detectors with addon boards) can have multiple functions, each with its own UUID for independent logical addressing.

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `uuid` | string | Yes | UUID v7 for this specific function |
| `type` | string | Yes | Function type (see table below) |
| `role` | string | Yes | "input" or "output" |

#### Function Types

| Type | Role | Description |
|------|------|-------------|
| `detector` | input | Smoke/heat detector |
| `mcp` | input | Manual Call Point |
| `co-sensor` | input | Carbon monoxide sensor |
| `sounder` | output | Audible alarm |
| `beacon-red` | output | Red visual alarm |
| `beacon-white` | output | White visual alarm |
| `voice` | output | Voice annunciation |

### Zones Object (v2.0)

```typescript
{
  detection: DetectionZone[];
  alarm: AlarmZone[];
}
```

### Detection Zone (v2.0)

| Field | Type | Description |
|-------|------|-------------|
| `id` | string | Zone ID (e.g., "DZ-01") |
| `uuid` | string | UUID v7 identifier for the zone |
| `name` | string | Human-readable zone name |
| `devices` | array | Device addresses in this zone |
| `linkedAlarmZones` | array | UUIDs of linked alarm zones |

### Alarm Zone (v2.0)

| Field | Type | Description |
|-------|------|-------------|
| `id` | string | Zone ID (e.g., "AZ-01") |
| `uuid` | string | UUID v7 identifier for the zone |
| `name` | string | Human-readable zone name |
| `devices` | array | Device addresses in this zone |

### Cause & Effect Rule (v2.0)

Now uses UUIDs instead of device addresses for zone-based logic.

| Field | Type | Description |
|-------|------|-------------|
| `id` | string | UUID v7 rule identifier |
| `inputZone` | string | UUID of detection zone (trigger) |
| `outputZone` | string | UUID of alarm zone (action) |
| `logic` | string | "OR" (any device) or "AND" (all devices) |
| `delay` | number | Delay in seconds before activation |

## Example (v2.0)

```json
{
  "version": "2.0",
  "projectName": "Office Building Floor 1",
  "createdAt": "2025-12-26T20:00:00Z",
  
  "devices": [
    {
      "address": "A.001.001",
      "primaryUuid": "019b5bfb-48a5-7000-8000-000000000001",
      "type": "detector",
      "subType": "heat-multi",
      "location": "Public Area",
      "label": "Autoguard Multi-Function",
      "functions": [
        { "uuid": "019b5bfb-48a5-7001-8000-000000000001", "type": "detector", "role": "input" },
        { "uuid": "019b5bfb-48a5-7002-8000-000000000002", "type": "sounder", "role": "output" },
        { "uuid": "019b5bfb-48a5-7003-8000-000000000003", "type": "beacon-red", "role": "output" }
      ]
    },
    {
      "address": "A.001.002",
      "primaryUuid": "019b5bfb-48a5-7000-8000-000000000002",
      "type": "detector",
      "location": "Office 1",
      "functions": [
        { "uuid": "019b5bfb-48a5-7004-8000-000000000004", "type": "detector", "role": "input" }
      ]
    },
    {
      "address": "A.001.013",
      "primaryUuid": "019b5bfb-48a5-7000-8000-000000000013",
      "type": "mcp",
      "location": "Public Area",
      "functions": [
        { "uuid": "019b5bfb-48a5-7013-8000-000000000013", "type": "mcp", "role": "input" }
      ]
    },
    {
      "address": "A.001.014",
      "primaryUuid": "019b5bfb-48a5-7000-8000-000000000014",
      "type": "sounder",
      "location": "Public Area",
      "functions": [
        { "uuid": "019b5bfb-48a5-7014-8000-000000000014", "type": "sounder", "role": "output" }
      ]
    }
  ],
  
  "zones": {
    "detection": [
      {
        "id": "DZ-01",
        "uuid": "019b5c00-0000-7000-8000-000000000001",
        "name": "Public Area",
        "devices": ["A.001.001", "A.001.013"],
        "linkedAlarmZones": ["019b5c00-0000-7000-8000-000000000101"]
      },
      {
        "id": "DZ-02",
        "uuid": "019b5c00-0000-7000-8000-000000000002",
        "name": "Office 1",
        "devices": ["A.001.002"],
        "linkedAlarmZones": ["019b5c00-0000-7000-8000-000000000101"]
      }
    ],
    "alarm": [
      {
        "id": "AZ-01",
        "uuid": "019b5c00-0000-7000-8000-000000000101",
        "name": "All Outputs",
        "devices": ["A.001.001", "A.001.014"]
      }
    ]
  },
  
  "causeEffect": [
    {
      "id": "019b5c00-ce00-7000-8000-000000000001",
      "inputZone": "019b5c00-0000-7000-8000-000000000001",
      "outputZone": "019b5c00-0000-7000-8000-000000000101",
      "logic": "OR",
      "delay": 0
    },
    {
      "id": "019b5c00-ce00-7000-8000-000000000002",
      "inputZone": "019b5c00-0000-7000-8000-000000000002",
      "outputZone": "019b5c00-0000-7000-8000-000000000101",
      "logic": "OR",
      "delay": 0
    }
  ]
}
```

## Migration from v1.0 to v2.0

1. **Add UUIDs**: Generate UUID v7 for each device, function, and zone
2. **Add functions array**: Convert device type to a functions array
3. **Update zones**: Add `uuid` field to each zone; convert `linkedAlarmZones` to use UUIDs
4. **Update causeEffect**: Use zone UUIDs instead of device addresses

## Notes

1. **UUID v7 Format**: Time-ordered UUIDs for database compatibility
2. **Multi-Function Devices**: A single physical device can have multiple logical functions
3. **Function-Based Assignment**: Each function can be independently assigned to zones
4. **Input Functions → Detection Zones**: detector, mcp, co-sensor
5. **Output Functions → Alarm Zones**: sounder, beacon-red, beacon-white, voice
6. **Zone Prefixes**: Detection zones use "DZ-", Alarm zones use "AZ-"
7. **OR vs AND Logic**: 
   - OR: Any single input triggers outputs
   - AND: All inputs must trigger within a time window
8. **Delay**: Time in seconds from condition met to output activation
